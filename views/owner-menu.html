<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/layout.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
  </head>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"
  ></script>
  <body>
    <!-- 헤더 를 하나만 만들고 갖다 붙이는 식으로 하면 될 것 같은데 어케함 ? -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <!-- 로고 -->
        <a class="navbar-brand" href="#">오죠사마 앙냥냥</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 검색 -->
        <form class="d-flex" role="search">
          <input
            class="form-control me-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>

        <!-- 로그인 버튼 -->
        <button>로그인</button>
      </div>
    </nav>
    <div class="detail-container">

    <table class="table menu-table table-hover ">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">이름</th>
          <th scope="col">가격</th>
        </tr>
      </thead>

        <tbody id="menu_detail" class="table-group-divider">
          <!-- 메뉴 목록 출력 -->
        </tbody>

    </table>
  </body>
  <!-- 프론트 비동기처리(?)-->
  <!-- 프론트에서 백으로 데이터 넘겨주기!-->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    // 브라우저가 열렸을 때 실행
    document.addEventListener('DOMContentLoaded', function () {
      // 쿼리 스트링 menu_id 받아오기
      const urlParams = new URLSearchParams(window.location.search);
      const menu_id = urlParams.get('menu_id');
      const $menu_detail = document.getElementById('menu_detail');

      // 메뉴 전체 조회
      // 내 매장의 메뉴들만 조회해야함
      // 일단 전체 메뉴 조회 ㄱ
      axios
        .get(`http://localhost:4000/api/menu?category=name&order=desc`, {
          withCredentials: true,
        })
        .then((response) => {
          console.log('response: ', response);
          // API 실행결과를 response로 받아와서 html 그려주기
          response.data.data.forEach((e,idx) => {
            let temp_html = `
            <th scope="row">${idx+1}</th>
            <td>${e.name}</td>
            <td>${e.price}</td>
            <td>
              <a href="http://localhost:5500/views/owner-menu.html?menu_id=${menu_id}">수정하기</a>
            </td>
            <td>
            <button type="button" onclick="submitDeleteForm()">삭제하기</button>
            </td>
              `;
            $menu_detail.insertAdjacentHTML('beforeend', temp_html);
          });
        })
        .catch((error) => {
          console.error('오류 발생:', error);
        });
    });
    function submitDeleteForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const menu_id = urlParams.get('menu_id');
      axios
        .delete(`http://localhost:4000/api/menus/${menu_id}`, {
          withCredentials: true,
        })
        .then((response) => {
          // 메인페이지로 이동시키기!
          // 내 글 조회 화면이 구현될 경우 해당 화면으로 이동시키기
          alert('삭제가 완료되었습니다.');
          window.location.href = 'http://localhost:5500/test-index.html';
        })
        .catch((error) => {
          console.error('오류 발생:', error);
        });
    }
  </script>
</html>
